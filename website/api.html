<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API | SensorMouse</title>
    <meta name="description" content="Documentación completa de la API de SensorMouse: endpoints, formatos de datos y ejemplos de integración.">
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    <link rel="stylesheet" href="assets/css/style.css?v=1.6">
    <link rel="stylesheet" href="assets/css/responsive.css?v=1.5">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="assets/images/logo.svg" alt="SensorMouse Logo" class="logo-img">
                <span class="logo-text">SensorMouse</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="index.html#home" class="nav-link">Inicio</a></li>
                <li class="nav-item"><a href="index.html#features" class="nav-link">Características</a></li>
                <li class="nav-item"><a href="index.html#download" class="nav-link">Descargar</a></li>
                <li class="nav-item"><a href="index.html#docs" class="nav-link">Documentación</a></li>
                <li class="nav-item"><a href="https://github.com/natone2/sensormouse" class="nav-link" target="_blank">GitHub</a></li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>
    <main class="container" style="margin-top:90px;min-height:60vh;">
        <div class="section-header">
            <h1 class="section-title">API de SensorMouse</h1>
            <p class="section-description">Documentación completa para desarrolladores que quieran integrar o extender SensorMouse.</p>
        </div>
        <section class="documentation">
            <h2>Información General</h2>
            <p>La API de SensorMouse permite la comunicación entre el cliente Android y el servidor Python mediante sockets TCP/IP con formato JSON.</p>
            
            <h2>Configuración del Servidor</h2>
            <p>El servidor escucha en el puerto 8080 por defecto. Puedes cambiar el puerto modificando la variable <code>PORT</code> en <code>server/main.py</code>.</p>
            
            <h2>Formato de Mensajes</h2>
            <p>Todos los mensajes se transmiten en formato JSON UTF-8 con la siguiente estructura base:</p>
            <pre data-language="json"><code>{
  "type": "sensor_data",
  "timestamp": 1640995200.123,
  "data": { ... }
}</code></pre>
            
            <h2>Tipos de Mensajes</h2>
            
            <h3>1. Datos de Sensores (sensor_data)</h3>
            <p>Enviado desde Android al servidor cada 20ms (50Hz).</p>
            <pre data-language="json"><code>{
  "type": "sensor_data",
  "timestamp": 1640995200.123,
  "data": {
    "gyro": {
      "x": 0.12,
      "y": -0.08,
      "z": 0.05
    },
    "accel": {
      "x": 0.01,
      "y": 0.02,
      "z": 9.81
    }
  }
}</code></pre>
            
            <h3>2. Estado de Conexión (connection_status)</h3>
            <p>Enviado cuando cambia el estado de la conexión.</p>
            <pre data-language="json"><code>{
  "type": "connection_status",
  "timestamp": 1640995200.123,
  "data": {
    "status": "connected",
    "device_info": {
      "model": "Samsung Galaxy S21",
      "android_version": "12"
    }
  }
}</code></pre>
            
            <h3>3. Configuración (config)</h3>
            <p>Enviado para configurar parámetros del servidor.</p>
            <pre data-language="json"><code>{
  "type": "config",
  "timestamp": 1640995200.123,
  "data": {
    "sensitivity": 1.5,
    "smoothing": 0.8,
    "calibration": {
      "gyro_offset": {"x": 0.01, "y": -0.02, "z": 0.0},
      "accel_offset": {"x": 0.0, "y": 0.0, "z": 0.0}
    }
  }
}</code></pre>
            
            <h2>Respuestas del Servidor</h2>
            
            <h3>Acknowledgement (ack)</h3>
            <pre data-language="json"><code>{
  "type": "ack",
  "timestamp": 1640995200.123,
  "data": {
    "message": "Data received successfully"
  }
}</code></pre>
            
            <h3>Error (error)</h3>
            <pre data-language="json"><code>{
  "type": "error",
  "timestamp": 1640995200.123,
  "data": {
    "code": "INVALID_DATA",
    "message": "Invalid sensor data format"
  }
}</code></pre>
            
            <h2>Ejemplos de Integración</h2>
            
            <h3>Cliente Python</h3>
            <pre data-language="python"><code>import socket
import json
import time

def send_sensor_data(host, port, gyro_x, gyro_y, gyro_z, accel_x, accel_y, accel_z):
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        sock.connect((host, port))
        
        message = {
            "type": "sensor_data",
            "timestamp": time.time(),
            "data": {
                "gyro": {"x": gyro_x, "y": gyro_y, "z": gyro_z},
                "accel": {"x": accel_x, "y": accel_y, "z": accel_z}
            }
        }
        
        sock.send(json.dumps(message).encode('utf-8'))
        response = sock.recv(1024).decode('utf-8')
        return json.loads(response)
        
    finally:
        sock.close()</code></pre>
            
            <h3>Cliente JavaScript (Node.js)</h3>
            <pre data-language="javascript"><code>const net = require('net');

function sendSensorData(host, port, sensorData) {
    return new Promise((resolve, reject) => {
        const client = new net.Socket();
        
        client.connect(port, host, () => {
            const message = {
                type: 'sensor_data',
                timestamp: Date.now() / 1000,
                data: sensorData
            };
            
            client.write(JSON.stringify(message));
        });
        
        client.on('data', (data) => {
            const response = JSON.parse(data.toString());
            client.destroy();
            resolve(response);
        });
        
        client.on('error', (err) => {
            client.destroy();
            reject(err);
        });
    });
}</code></pre>
            
            <h2>Códigos de Error</h2>
            <table>
                <tr>
                    <th>Código</th>
                    <th>Descripción</th>
                </tr>
                <tr>
                    <td>INVALID_DATA</td>
                    <td>Formato de datos inválido</td>
                </tr>
                <tr>
                    <td>CONNECTION_LIMIT</td>
                    <td>Límite de conexiones alcanzado</td>
                </tr>
                <tr>
                    <td>SENSOR_ERROR</td>
                    <td>Error en lectura de sensores</td>
                </tr>
                <tr>
                    <td>TIMEOUT</td>
                    <td>Timeout de conexión</td>
                </tr>
            </table>
            
            <h2>Límites y Restricciones</h2>
            <ul>
                <li><strong>Frecuencia máxima:</strong> 100Hz (10ms entre mensajes)</li>
                <li><strong>Tamaño de mensaje:</strong> Máximo 1KB por mensaje</li>
                <li><strong>Conexiones simultáneas:</strong> 1 cliente por servidor</li>
                <li><strong>Timeout:</strong> 30 segundos de inactividad</li>
            </ul>
        </section>
    </main>
    <footer class="footer">
        <div class="footer-content container">
            <div class="footer-logo">
                <img src="assets/images/logo.svg" alt="SensorMouse Logo" class="logo-img">
                <span class="logo-text">SensorMouse</span>
            </div>
            <div class="footer-section">
                <h4>Documentación</h4>
                <ul>
                    <li><a href="instalacion.html">Instalación</a></li>
                    <li><a href="technical_specs.html">Especificaciones Técnicas</a></li>
                    <li><a href="api.html">API</a></li>
                    <li><a href="faq.html">FAQ</a></li>
                    <li><a href="troubleshooting.html">Solución de Problemas</a></li>
                    <li><a href="changelog.html">Changelog</a></li>
                    <li><a href="contributing.html">Contribuir</a></li>
                    <li><a href="roadmap.html">Roadmap</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Proyecto</h4>
                <ul>
                    <li><a href="https://github.com/natone2/sensormouse" target="_blank">GitHub</a></li>
                    <li><a href="index.html#download">Descargar</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Contacto</h4>
                <ul>
                    <li><a href="mailto:soporte@sensormouse.com">soporte@sensormouse.com</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 SensorMouse. GPLv3. Hecho con <i class="fas fa-heart"></i> por la comunidad.</p>
            <div class="author-credit">Desarrollado por <a href="https://natone.pro" target="_blank" rel="noopener">Alex M</a></div>
        </div>
    </footer>
    <script src="assets/js/main.js"></script>
</body>
</html> 